<!--pages/join/join.wxml-->
<view class="container">
  <!-- èšä¼šä¿¡æ¯ -->
  <view class="gathering-info card" wx:if="{{gathering}}">
    <view class="info-header">
      <text class="info-title">é‚€è¯·ç ï¼š{{code}}</text>
      <text class="info-type">{{gathering.type === 'meal' ? 'ğŸœ èšé¤' : gathering.type === 'coffee' ? 'â˜• å’–å•¡' : 'ğŸ‰ èšä¼š'}}</text>
    </view>
    <view class="info-content">
      <text class="info-text">å·²æœ‰ {{gathering.participants.length}} äººåŠ å…¥</text>
    </view>
  </view>
  
  <!-- è®¾ç½®æ˜µç§° -->
  <view class="section">
    <view class="section-title">æ‚¨çš„æ˜µç§°ï¼ˆå¯é€‰ï¼‰</view>
    <input 
      class="input-nickname" 
      placeholder="è¾“å…¥æ˜µç§°ï¼Œä¸å¡«åˆ™æ˜¾ç¤ºåŒ¿åç”¨æˆ·"
      value="{{nickname}}"
      bindinput="inputNickname"
    />
  </view>
  
  <!-- è®¾ç½®ä½ç½® -->
  <view class="section">
    <view class="section-title">æ‚¨çš„ä½ç½® *</view>
    <view class="location-box card">
      <view class="location-content">
        <view wx:if="{{locationAddress}}" class="location-info">
          <text class="location-icon">ğŸ“</text>
          <text class="location-text">{{locationAddress}}</text>
        </view>
        <view wx:else class="location-empty">
          <text>è¯·è®¾ç½®æ‚¨çš„ä½ç½®</text>
        </view>
      </view>
      
      <view class="location-actions">
        <button class="btn-location" bindtap="getCurrentLocation">
          <text class="btn-icon">ğŸ“</text>
          <text>å½“å‰ä½ç½®</text>
        </button>
        <button class="btn-location" bindtap="chooseLocation">
          <text class="btn-icon">ğŸ—ºï¸</text>
          <text>é€‰æ‹©åœ°ç‚¹</text>
        </button>
        <button class="btn-location" bindtap="inputAddress">
          <text class="btn-icon">âœï¸</text>
          <text>æ‰‹åŠ¨è¾“å…¥</text>
        </button>
      </view>
    </view>
  </view>
  
  <!-- å½“å‰å‚ä¸è€… -->
  <view class="section" wx:if="{{gathering && gathering.participants.length > 0}}">
    <view class="section-title">å·²åŠ å…¥çš„æœ‹å‹</view>
    <view class="participant-list">
      <view class="participant-item" wx:for="{{gathering.participants}}" wx:key="temp_id">
        <text class="participant-name">{{item.nickname || 'åŒ¿åç”¨æˆ·'}}</text>
        <text class="participant-location">{{item.location ? item.location.address : 'æœªè®¾ç½®ä½ç½®'}}</text>
      </view>
    </view>
  </view>
  
  <!-- åŠ å…¥æŒ‰é’® -->
  <view class="bottom-action">
    <button 
      class="btn-primary btn-join" 
      bindtap="joinGathering"
      disabled="{{!myLocation || isJoining}}"
    >
      {{isJoining ? 'åŠ å…¥ä¸­...' : 'åŠ å…¥èšä¼š'}}
    </button>
    
    <view class="tips">
      <text>åŠ å…¥åå¯ä»¥æŸ¥çœ‹æ™ºèƒ½æ¨èçš„èšä¼šåœ°ç‚¹</text>
    </view>
  </view>
</view>